<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¬è©¦åˆ©æ½¤èª¿è©¦</title>
</head>
<body>
    <h1>æ¸¬è©¦åˆ©æ½¤èª¿è©¦ä»£ç¢¼</h1>
    <button onclick="testProfitDebug()">æ¸¬è©¦èª¿è©¦ä»£ç¢¼</button>
    <div id="output"></div>

    <script>
        function testProfitDebug() {
            // æ¨¡æ“¬åˆ©æ½¤ææ¬¾è¨˜éŒ„
            const mockRecords = [
                {
                    id: 1,
                    type: 'PROFIT_WITHDRAW',
                    entry_type: 'PROFIT_WITHDRAW',
                    description: 'åˆ©æ½¤ææ¬¾',
                    profit_before: 1000.50,
                    profit_after: 950.50,
                    profit_change: -50.0,
                    profit: -50.0
                },
                {
                    id: 2,
                    type: 'åˆ©æ½¤æ‰£é™¤',
                    entry_type: 'PROFIT_WITHDRAW',
                    description: 'åˆ©æ½¤ææ¬¾',
                    profit_before: null,
                    profit_after: null,
                    profit_change: null,
                    profit: -20.0
                }
            ];

            console.log('ğŸ§ª é–‹å§‹æ¸¬è©¦åˆ©æ½¤èª¿è©¦ä»£ç¢¼...');
            
            mockRecords.forEach(function(m, index) {
                console.log(`\n--- æ¸¬è©¦è¨˜éŒ„ ${index + 1} ---`);
                
                // è§£æåˆ©æ½¤è©³ç´°ä¿¡æ¯
                const profitBefore = parseFloat(m.profit_before ?? m.profitBefore) || null;
                const profitAfter = parseFloat(m.profit_after ?? m.profitAfter) || null;
                const profitChange = parseFloat(m.profit_change ?? m.profitChange) || null;
                
                // åˆ¤æ–·æ˜¯å¦ç‚ºåˆ©æ½¤ææ¬¾
                const rawType = (m.entry_type ?? m.type ?? '').toString();
                const isProfitWithdraw = rawType === 'PROFIT_WITHDRAW' || rawType === 'åˆ©æ½¤æ‰£é™¤' || (m.description ?? '').includes('åˆ©æ½¤ææ¬¾');
                
                console.log('åŸå§‹è¨˜éŒ„:', m);
                console.log('è§£æçµæœ:', { profitBefore, profitAfter, profitChange });
                console.log('æ˜¯å¦ç‚ºåˆ©æ½¤ææ¬¾:', isProfitWithdraw);
                
                if (isProfitWithdraw) {
                    console.log('ğŸ” åˆ©æ½¤ææ¬¾è¨˜éŒ„èª¿è©¦:', {
                        id: m.id,
                        type: m.type,
                        entry_type: m.entry_type,
                        description: m.description,
                        profit_before: m.profit_before,
                        profit_after: m.profit_after,
                        profit_change: m.profit_change,
                        profit: m.profit,
                        parsed_profitBefore: profitBefore,
                        parsed_profitAfter: profitAfter,
                        parsed_profitChange: profitChange
                    });
                } else if ((m.type + '').includes('WITHDRAW') || (m.description ?? '').includes('ææ¬¾')) {
                    console.log('â„¹ï¸ ç–‘ä¼¼ææ¬¾ä½†æœªè­˜åˆ¥ç‚ºåˆ©æ½¤ææ¬¾ï¼ŒåŸå§‹è³‡æ–™ m =', m);
                }
                
                // æ¸¬è©¦æ¸²æŸ“é‚è¼¯
                let profitDetailHtml = '-';
                
                if (isProfitWithdraw) {
                    console.log('ğŸ¨ åˆ©æ½¤è®Šå‹•è©³æƒ…æ¸²æŸ“èª¿è©¦:', {
                        id: m.id,
                        profitBefore: profitBefore,
                        profitAfter: profitAfter,
                        profitChange: profitChange,
                        profit: m.profit,
                        willShowDetailed: (profitBefore !== null && profitAfter !== null && profitChange !== null),
                        willShowSimple: (m.profit !== 0)
                    });
                }
                
                if (profitBefore !== null && profitAfter !== null && profitChange !== null) {
                    const profitBeforeDisplay = profitBefore.toLocaleString('en-US', {minimumFractionDigits: 2});
                    const profitAfterDisplay = profitAfter.toLocaleString('en-US', {minimumFractionDigits: 2});
                    const profitChangeDisplay = (profitChange > 0 ? '+' : '') + profitChange.toLocaleString('en-US', {minimumFractionDigits: 2});
                    
                    console.log('âœ… æ¸²æŸ“è©³ç´°åˆ©æ½¤ä¿¡æ¯:', {
                        id: m.id,
                        before: profitBeforeDisplay,
                        after: profitAfterDisplay,
                        change: profitChangeDisplay
                    });
                    
                    const changeColorClass = profitChange > 0 ? 'text-success' : 'text-danger';
                    const changeSymbol = profitChange > 0 ? '+' : '';
                    
                    profitDetailHtml = '<div class="small running-balance">' +
                        '<div class="text-info fw-bold border-bottom border-info pb-1 mb-1">å‰: ' + profitBeforeDisplay + '</div>' +
                        '<div class="text-info border-bottom border-info pb-1 mb-1">å¾Œ: ' + profitAfterDisplay + '</div>' +
                        '<div class="' + changeColorClass + ' fw-bold">è®Š: ' + changeSymbol + profitChangeDisplay + '</div>' +
                        '</div>';
                } else if (m.profit !== 0) {
                    console.log('âš ï¸ ä½¿ç”¨ç°¡åŒ–é¡¯ç¤ºï¼ˆç¼ºå°‘è©³ç´°æ•¸æ“šï¼‰');
                    profitDetailHtml = '<div class="small running-balance">' +
                        '<div class="text-muted">å‰: è¨ˆç®—ä¸­...</div>' +
                        '<div class="text-muted">å¾Œ: è¨ˆç®—ä¸­...</div>' +
                        '<div class="text-danger fw-bold">è®Š: ' + m.profit + '</div>' +
                        '</div>';
                }
                
                console.log('æœ€çµ‚ HTML:', profitDetailHtml);
            });
            
            console.log('\nğŸ§ª æ¸¬è©¦å®Œæˆï¼');
        }
    </script>
</body>
</html>
