<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»˜æ¬¾å¸³æˆ¶æ•¸æ“šä¿®å¾©æ¸¬è©¦</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="bi bi-credit-card me-2"></i>ä»˜æ¬¾å¸³æˆ¶æ•¸æ“šä¿®å¾©æ¸¬è©¦</h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h6><i class="bi bi-info-circle me-2"></i>å•é¡Œæè¿°</h6>
                            <p>å¾…ä»˜æ¬¾é …éŠ·å¸³æ¨¡æ…‹æ¡†ä¸­çš„ã€Œå¾å“ªå€‹ TWD å¸³æˆ¶ä»˜æ¬¾ã€ä¸‹æ‹‰é¸å–®ç„¡æ³•è¼‰å…¥å¸³æˆ¶æ•¸æ“šï¼Œé¡¯ç¤ºã€Œ--- è«‹é¸æ“‡ä»˜æ¬¾å¸³æˆ¶ ---ã€ä½†æ²’æœ‰é¸é …ã€‚</p>
                        </div>

                        <div class="mb-4">
                            <h5>æ¸¬è©¦ 1: æ¨¡æ“¬ accountsByHolder æ•¸æ“šçµæ§‹</h5>
                            <button class="btn btn-primary" onclick="simulateAccountsData()">æ¨¡æ“¬æ•¸æ“š</button>
                            <div id="result1" class="mt-2 text-muted"></div>
                        </div>

                        <div class="mb-4">
                            <h5>æ¸¬è©¦ 2: æ¸¬è©¦ populatePaymentAccounts å‡½æ•¸</h5>
                            <button class="btn btn-primary" onclick="testPopulateFunction()">æ¸¬è©¦å‡½æ•¸</button>
                            <div id="result2" class="mt-2 text-muted"></div>
                        </div>

                        <div class="mb-4">
                            <h5>æ¸¬è©¦ 3: å¯¦éš›ä»˜æ¬¾å¸³æˆ¶é¸æ“‡</h5>
                            <div class="mb-3">
                                <label for="testPaymentSelect" class="form-label">ä»˜æ¬¾å¸³æˆ¶é¸æ“‡</label>
                                <select class="form-select" id="testPaymentSelect">
                                    <option value="" disabled selected>--- è«‹é¸æ“‡ä»˜æ¬¾å¸³æˆ¶ ---</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="populateTestSelect()">å¡«å……æ¸¬è©¦é¸é …</button>
                            <div id="result3" class="mt-2 text-muted"></div>
                        </div>

                        <div class="alert alert-success">
                            <h6><i class="bi bi-check-circle me-2"></i>ä¿®å¾©å…§å®¹</h6>
                            <ul class="mb-0">
                                <li>âœ… ä¿®å¾©äº† <code>populatePaymentAccounts</code> å‡½æ•¸çš„æ•¸æ“šæºå•é¡Œ</li>
                                <li>âœ… å°‡ <code>accountsByHolder</code> è¨­ç‚ºå…¨åŸŸè®Šæ•¸</li>
                                <li>âœ… æ›´æ–°å‡½æ•¸ä½¿ç”¨æ­£ç¢ºçš„æ•¸æ“šçµæ§‹</li>
                                <li>âœ… æ·»åŠ è©³ç´°çš„èª¿è©¦æ—¥èªŒ</li>
                                <li>âœ… å¢åŠ éŒ¯èª¤è™•ç†å’Œç”¨æˆ¶æç¤º</li>
                            </ul>
                        </div>

                        <div class="alert alert-warning">
                            <h6><i class="bi bi-exclamation-triangle me-2"></i>ä¿®å¾©å‰å¾Œå°æ¯”</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>ä¿®å¾©å‰ï¼š</h6>
                                    <ul>
                                        <li>âŒ ä½¿ç”¨ <code>window.owner_accounts</code>ï¼ˆä¸å­˜åœ¨ï¼‰</li>
                                        <li>âŒ ç„¡æ³•ç²å–å¸³æˆ¶æ•¸æ“š</li>
                                        <li>âŒ ä¸‹æ‹‰é¸å–®ç‚ºç©º</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6>ä¿®å¾©å¾Œï¼š</h6>
                                    <ul>
                                        <li>âœ… ä½¿ç”¨ <code>window.accountsByHolder</code>ï¼ˆæ­£ç¢ºï¼‰</li>
                                        <li>âœ… æ­£ç¢ºç²å– TWD å¸³æˆ¶æ•¸æ“š</li>
                                        <li>âœ… ä¸‹æ‹‰é¸å–®åŒ…å«æ‰€æœ‰ TWD å¸³æˆ¶</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ“¬ accountsByHolder æ•¸æ“šçµæ§‹
        function simulateAccountsData() {
            // æ¨¡æ“¬ç¾é‡‘ç®¡ç†é é¢çš„æ•¸æ“šçµæ§‹
            window.accountsByHolder = {
                "1": {
                    "id": 1,
                    "name": "æ¸¬è©¦æŒæœ‰äººA",
                    "accounts": [
                        {
                            "id": 1,
                            "name": "å°å¹£å¸³æˆ¶A",
                            "currency": "TWD",
                            "balance": 1000000.00
                        },
                        {
                            "id": 2,
                            "name": "äººæ°‘å¹£å¸³æˆ¶A",
                            "currency": "RMB",
                            "balance": 50000.00
                        }
                    ]
                },
                "2": {
                    "id": 2,
                    "name": "æ¸¬è©¦æŒæœ‰äººB",
                    "accounts": [
                        {
                            "id": 3,
                            "name": "å°å¹£å¸³æˆ¶B",
                            "currency": "TWD",
                            "balance": 2000000.00
                        },
                        {
                            "id": 4,
                            "name": "äººæ°‘å¹£å¸³æˆ¶B",
                            "currency": "RMB",
                            "balance": 30000.00
                        }
                    ]
                }
            };
            
            let result = `
                <div class="alert alert-success">
                    <h6>æ¨¡æ“¬æ•¸æ“šçµæ§‹ï¼š</h6>
                    <pre class="bg-light p-3"><code>window.accountsByHolder = {
  "1": {
    "name": "æ¸¬è©¦æŒæœ‰äººA",
    "accounts": [
      { "id": 1, "name": "å°å¹£å¸³æˆ¶A", "currency": "TWD", "balance": 1000000.00 },
      { "id": 2, "name": "äººæ°‘å¹£å¸³æˆ¶A", "currency": "RMB", "balance": 50000.00 }
    ]
  },
  "2": {
    "name": "æ¸¬è©¦æŒæœ‰äººB", 
    "accounts": [
      { "id": 3, "name": "å°å¹£å¸³æˆ¶B", "currency": "TWD", "balance": 2000000.00 },
      { "id": 4, "name": "äººæ°‘å¹£å¸³æˆ¶B", "currency": "RMB", "balance": 30000.00 }
    ]
  }
}</code></pre>
                    <p><strong>âœ… æ¨¡æ“¬æ•¸æ“šè¨­ç½®å®Œæˆï¼ŒåŒ…å« 2 å€‹ TWD å¸³æˆ¶</strong></p>
                </div>
            `;
            
            document.getElementById('result1').innerHTML = result;
        }

        // æ¸¬è©¦ populatePaymentAccounts å‡½æ•¸é‚è¼¯
        function testPopulateFunction() {
            if (!window.accountsByHolder) {
                document.getElementById('result2').innerHTML = `
                    <div class="alert alert-warning">
                        <strong>âš ï¸ è«‹å…ˆé»æ“Šã€Œæ¨¡æ“¬æ•¸æ“šã€æŒ‰éˆ•è¨­ç½®æ¸¬è©¦æ•¸æ“š</strong>
                    </div>
                `;
                return;
            }
            
            let twdAccounts = [];
            let totalAccounts = 0;
            
            Object.keys(window.accountsByHolder).forEach(holderId => {
                const holderData = window.accountsByHolder[holderId];
                if (holderData && holderData.accounts) {
                    holderData.accounts.forEach(account => {
                        totalAccounts++;
                        if (account.currency === 'TWD') {
                            twdAccounts.push({
                                id: account.id,
                                name: account.name,
                                balance: account.balance
                            });
                        }
                    });
                }
            });
            
            let result = `
                <div class="alert alert-success">
                    <h6>å‡½æ•¸æ¸¬è©¦çµæœï¼š</h6>
                    <p><strong>ç¸½å¸³æˆ¶æ•¸ï¼š</strong> ${totalAccounts}</p>
                    <p><strong>TWD å¸³æˆ¶æ•¸ï¼š</strong> ${twdAccounts.length}</p>
                    <p><strong>TWD å¸³æˆ¶åˆ—è¡¨ï¼š</strong></p>
                    <ul>
            `;
            
            twdAccounts.forEach(account => {
                result += `<li>${account.name} (é¤˜é¡: TWD ${account.balance.toLocaleString()})</li>`;
            });
            
            result += `
                    </ul>
                    <p><strong>âœ… å‡½æ•¸é‚è¼¯æ¸¬è©¦é€šéï¼Œå¯ä»¥æ­£ç¢ºè­˜åˆ¥ TWD å¸³æˆ¶</strong></p>
                </div>
            `;
            
            document.getElementById('result2').innerHTML = result;
        }

        // å¯¦éš›å¡«å……æ¸¬è©¦ä¸‹æ‹‰é¸å–®
        function populateTestSelect() {
            if (!window.accountsByHolder) {
                document.getElementById('result3').innerHTML = `
                    <div class="alert alert-warning">
                        <strong>âš ï¸ è«‹å…ˆé»æ“Šã€Œæ¨¡æ“¬æ•¸æ“šã€æŒ‰éˆ•è¨­ç½®æ¸¬è©¦æ•¸æ“š</strong>
                    </div>
                `;
                return;
            }
            
            const paymentAccountSelect = document.getElementById('testPaymentSelect');
            if (!paymentAccountSelect) return;
            
            console.log('ğŸ” é–‹å§‹å¡«å……ä»˜æ¬¾å¸³æˆ¶é¸é …...');
            
            // æ¸…ç©ºç¾æœ‰é¸é …
            paymentAccountSelect.innerHTML = '<option value="" disabled selected>--- è«‹é¸æ“‡ä»˜æ¬¾å¸³æˆ¶ ---</option>';
            
            let twdAccountCount = 0;
            
            Object.keys(window.accountsByHolder).forEach(holderId => {
                const holderData = window.accountsByHolder[holderId];
                if (holderData && holderData.accounts) {
                    holderData.accounts.forEach(account => {
                        if (account.currency === 'TWD') {
                            const option = document.createElement('option');
                            option.value = account.id;
                            option.textContent = `${account.name} (é¤˜é¡: ${account.currency} ${account.balance.toLocaleString()})`;
                            paymentAccountSelect.appendChild(option);
                            twdAccountCount++;
                            console.log('âœ… æ·»åŠ  TWD å¸³æˆ¶:', account.name, 'é¤˜é¡:', account.balance);
                        }
                    });
                }
            });
            
            let result = `
                <div class="alert alert-success">
                    <h6>å¯¦éš›å¡«å……çµæœï¼š</h6>
                    <p><strong>âœ… æˆåŠŸæ·»åŠ  ${twdAccountCount} å€‹ TWD å¸³æˆ¶åˆ°ä¸‹æ‹‰é¸å–®</strong></p>
                    <p>ç¾åœ¨å¯ä»¥å¾ä¸‹æ‹‰é¸å–®ä¸­é¸æ“‡ä»˜æ¬¾å¸³æˆ¶äº†ï¼</p>
                </div>
            `;
            
            document.getElementById('result3').innerHTML = result;
        }
    </script>
</body>
</html>



