# 庫存管理系統

## 系統概述

庫存管理系統是一個完整的RMB庫存管理解決方案，支持FIFO（先進先出）庫存管理、匯率管理、庫存調整等功能。系統會自動與現金帳戶系統整合，確保庫存操作與資金流動的同步。

## 主要功能

### 1. 庫存概況監控
- **總庫存RMB**: 顯示當前可用RMB庫存總量
- **庫存價值TWD**: 按當前匯率計算的台幣價值
- **平均匯率**: 加權平均成本匯率
- **庫存批次**: 活躍庫存批次數量

### 2. 新增庫存
新增庫存時需要填寫以下必填資訊：
- **渠道來源**: 選擇庫存來源渠道
- **RMB數量**: 要新增的RMB數量
- **買入匯率**: 當時的買入匯率
- **付款帳戶**: 從此帳戶扣除台幣款項
- **收款帳戶**: RMB將存入此帳戶

**重要提醒**: 新增庫存時，系統會自動：
- 從付款帳戶扣除對應的台幣款項
- 將RMB存入收款帳戶
- 創建FIFO庫存記錄
- 記錄操作日誌

### 3. 庫存調整
庫存調整支持三種操作類型：

#### 增加庫存
- 從指定的來源帳戶扣除RMB
- 增加庫存批次數量
- 需要填寫來源帳戶、流向帳戶、調整匯率

#### 減少庫存
- 從庫存批次中扣除指定數量
- 將RMB轉入指定的流向帳戶
- 需要填寫來源帳戶、流向帳戶、調整匯率

#### 庫存報銷
- 將庫存標記為報銷
- 將RMB轉入指定的流向帳戶
- 需要填寫來源帳戶、流向帳戶、調整匯率

### 4. 匯率管理
- **全局匯率調整**: 一次性調整所有活躍庫存批次的匯率
- **批次匯率調整**: 針對特定批次調整匯率
- **市場匯率更新**: 根據市場情況更新匯率

### 5. 操作日誌
系統會記錄所有庫存操作的詳細資訊：
- 操作時間和類型
- 操作人員
- 批次ID和變動數量
- 變動前後餘額
- 來源/流向帳戶
- 操作時匯率
- 備註說明

## 系統特點

### 1. 完整性驗證
- 所有庫存操作都必須填寫來源、流向、匯率
- 系統會驗證帳戶餘額是否充足
- 防止超額操作和數據不一致

### 2. 自動化整合
- 庫存操作自動更新現金帳戶餘額
- 無需手動記帳，減少人為錯誤
- 完整的審計追蹤

### 3. FIFO管理
- 嚴格按照先進先出原則管理庫存
- 準確計算庫存成本和價值
- 支持庫存分配和消耗追蹤

### 4. 安全性保障
- 所有操作都需要登入驗證
- 操作日誌完整記錄
- 事務性操作確保數據一致性

## 使用流程

### 新增庫存流程
1. 點擊「新增庫存」按鈕
2. 填寫渠道來源、RMB數量、買入匯率
3. 選擇付款帳戶（台幣）和收款帳戶（RMB）
4. 填寫備註說明
5. 系統驗證帳戶餘額
6. 確認新增，系統自動更新庫存和帳戶餘額

### 庫存調整流程
1. 點擊「庫存調整」按鈕
2. 選擇要調整的庫存批次
3. 選擇調整類型（增加/減少/報銷）
4. 填寫調整數量和原因
5. 選擇來源帳戶和流向帳戶
6. 填寫調整匯率
7. 系統驗證操作可行性
8. 確認調整，系統自動更新庫存和帳戶餘額

### 匯率管理流程
1. 點擊「匯率管理」按鈕
2. 選擇匯率變更類型
3. 查看當前匯率
4. 輸入新匯率
5. 填寫變更原因
6. 確認變更，系統更新相關庫存批次

## 技術架構

### 前端技術
- HTML5 + CSS3 + Bootstrap 5
- JavaScript ES6+
- 響應式設計，支持移動端

### 後端技術
- Python Flask框架
- SQLAlchemy ORM
- 事務性數據庫操作
- RESTful API設計

### 數據庫設計
- FIFO庫存表：記錄庫存批次和狀態
- 庫存日誌表：記錄所有操作歷史
- 現金帳戶表：與現金管理系統整合
- 買入記錄表：記錄庫存來源信息

## 注意事項

### 1. 操作前檢查
- 確保有足夠的帳戶餘額
- 檢查庫存批次狀態
- 驗證匯率數據的準確性

### 2. 數據一致性
- 系統使用事務確保數據一致性
- 操作失敗時會自動回滾
- 定期檢查庫存與帳戶餘額的匹配性

### 3. 權限管理
- 只有授權用戶可以進行庫存操作
- 管理員可以查看所有操作日誌
- 操作人員對自己的操作負責

## 故障排除

### 常見問題
1. **帳戶餘額不足**: 檢查付款帳戶餘額，確保足夠支付
2. **庫存不足**: 檢查庫存批次餘額，確保有足夠庫存可調整
3. **匯率錯誤**: 驗證匯率數據的正確性
4. **操作失敗**: 檢查必填欄位是否完整，帳戶是否存在

### 聯繫支持
如遇到技術問題，請聯繫系統管理員或查看系統日誌獲取詳細錯誤信息。

---

*最後更新: 2024年12月*
*版本: 2.0*

