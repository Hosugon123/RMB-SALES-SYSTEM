<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°æ•¸é»è¼¸å…¥è©³ç´°æ¸¬è©¦</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-section {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #f8f9fa;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        .warning { background-color: #fff3cd; color: #856404; }
        
        .input-test {
            border: 2px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            background-color: white;
        }
        
        .input-test.focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }
        
        .test-step {
            margin: 15px 0;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">ğŸ”§ å°æ•¸é»è¼¸å…¥è©³ç´°æ¸¬è©¦</h1>
        
        <div class="alert alert-warning">
            <strong>æ¸¬è©¦é‡é»ï¼š</strong> é©—è­‰å°æ•¸é»è¼¸å…¥çš„å„ç¨®æƒ…æ³ï¼Œç‰¹åˆ¥æ˜¯ã€Œæ²’è¼¸å…¥æ•¸å­—æ™‚å¯ä»¥è¼¸å…¥å°æ•¸é»ï¼Œåä¹‹å‰‡ç„¡æ³•è¼¸å…¥å°æ•¸é»ã€çš„å•é¡Œã€‚
        </div>

        <!-- åŸºæœ¬å°æ•¸é»è¼¸å…¥æ¸¬è©¦ -->
        <div class="test-section">
            <h3>ğŸ”¢ åŸºæœ¬å°æ•¸é»è¼¸å…¥æ¸¬è©¦</h3>
            <p>æ¸¬è©¦å„ç¨®å°æ•¸é»è¼¸å…¥æƒ…æ³ï¼š</p>
            
            <div class="input-test">
                <label for="basicDecimal" class="form-label">åŸºæœ¬å°æ•¸é»æ¸¬è©¦</label>
                <input type="text" class="form-control" id="basicDecimal" 
                       pattern="[0-9]*\.?[0-9]*" placeholder="æ¸¬è©¦å°æ•¸é»è¼¸å…¥">
                <small class="text-muted">æ¸¬è©¦æ­¥é©Ÿï¼š1. è¼¸å…¥ . â†’ 2. è¼¸å…¥ 4 â†’ 3. è¼¸å…¥ . â†’ 4. è¼¸å…¥ 5</small>
            </div>

            <div class="test-step">
                <strong>æ¸¬è©¦æ­¥é©Ÿ 1ï¼š</strong> é»æ“Šæ¬„ä½ï¼Œè¼¸å…¥ <code>.</code> â†’ æ‡‰è©²é¡¯ç¤º <code>.</code>
            </div>
            <div class="test-step">
                <strong>æ¸¬è©¦æ­¥é©Ÿ 2ï¼š</strong> ç¹¼çºŒè¼¸å…¥ <code>4</code> â†’ æ‡‰è©²é¡¯ç¤º <code>4</code>
            </div>
            <div class="test-step">
                <strong>æ¸¬è©¦æ­¥é©Ÿ 3ï¼š</strong> ç¹¼çºŒè¼¸å…¥ <code>.</code> â†’ æ‡‰è©²é¡¯ç¤º <code>4.</code>
            </div>
            <div class="test-step">
                <strong>æ¸¬è©¦æ­¥é©Ÿ 4ï¼š</strong> ç¹¼çºŒè¼¸å…¥ <code>5</code> â†’ æ‡‰è©²é¡¯ç¤º <code>4.5</code>
            </div>

            <button class="btn btn-primary" onclick="testBasicDecimal()">ğŸ§ª åŸ·è¡ŒåŸºæœ¬æ¸¬è©¦</button>
            <div id="basicTestResult" class="test-result d-none"></div>
        </div>

        <!-- åŒ¯ç‡æ¬„ä½æ¸¬è©¦ -->
        <div class="test-section">
            <h3>ğŸ“Š åŒ¯ç‡æ¬„ä½å°æ•¸é»æ¸¬è©¦</h3>
            <p>æ¸¬è©¦åŒ¯ç‡æ¬„ä½çš„ç‰¹æ®Šå°æ•¸é»è™•ç†ï¼š</p>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="input-test">
                        <label for="buyRate" class="form-label">è²·å…¥åŒ¯ç‡</label>
                        <input type="text" class="form-control" id="buyRate" 
                               pattern="[0-9]*\.?[0-9]*" placeholder="ä¾‹å¦‚: 4.5000">
                        <small class="text-muted">æ¸¬è©¦: . â†’ 4 â†’ . â†’ 5 â†’ 0 â†’ 0 â†’ 0</small>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="input-test">
                        <label for="sellRate" class="form-label">è³£å‡ºåŒ¯ç‡</label>
                        <input type="text" class="form-control" id="sellRate" 
                               pattern="[0-9]*\.?[0-9]*" placeholder="ä¾‹å¦‚: 4.6000">
                        <small class="text-muted">æ¸¬è©¦: . â†’ 4 â†’ . â†’ 6 â†’ 0 â†’ 0 â†’ 0</small>
                    </div>
                </div>
            </div>

            <button class="btn btn-success" onclick="testRateInputs()">ğŸ§ª æ¸¬è©¦åŒ¯ç‡è¼¸å…¥</button>
            <div id="rateTestResult" class="test-result d-none"></div>
        </div>

        <!-- é‚Šç•Œæƒ…æ³æ¸¬è©¦ -->
        <div class="test-section">
            <h3>âš ï¸ é‚Šç•Œæƒ…æ³æ¸¬è©¦</h3>
            <p>æ¸¬è©¦å„ç¨®é‚Šç•Œæƒ…æ³ï¼š</p>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="input-test">
                        <label for="edgeTest1" class="form-label">æ¸¬è©¦ 1: é€£çºŒå°æ•¸é»</label>
                        <input type="text" class="form-control" id="edgeTest1" 
                               pattern="[0-9]*\.?[0-9]*" placeholder="è¼¸å…¥ 4..5">
                        <small class="text-muted">æ‡‰è©²é˜»æ­¢å¤šå€‹å°æ•¸é»</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="input-test">
                        <label for="edgeTest2" class="form-label">æ¸¬è©¦ 2: å°æ•¸é»é–‹é ­</label>
                        <input type="text" class="form-control" id="edgeTest2" 
                               pattern="[0-9]*\.?[0-9]*" placeholder="è¼¸å…¥ .5">
                        <small class="text-muted">æ‡‰è©²å…è¨± .5</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="input-test">
                        <label for="edgeTest3" class="form-label">æ¸¬è©¦ 3: å°æ•¸é»çµå°¾</label>
                        <input type="text" class="form-control" id="edgeTest3" 
                               pattern="[0-9]*\.?[0-9]*" placeholder="è¼¸å…¥ 4.">
                        <small class="text-muted">æ‡‰è©²å…è¨± 4.</small>
                    </div>
                </div>
            </div>

            <button class="btn btn-warning" onclick="testEdgeCases()">ğŸ§ª æ¸¬è©¦é‚Šç•Œæƒ…æ³</button>
            <div id="edgeTestResult" class="test-result d-none"></div>
        </div>

        <!-- å¯¦æ™‚ç›£æ§ -->
        <div class="test-section">
            <h3>ğŸ“Š å¯¦æ™‚è¼¸å…¥ç›£æ§</h3>
            <p>ç›£æ§æ‰€æœ‰æ¬„ä½çš„å¯¦æ™‚è¼¸å…¥ç‹€æ…‹ï¼š</p>
            
            <div id="realTimeMonitor" class="alert alert-info">
                <strong>å¯¦æ™‚ç‹€æ…‹ï¼š</strong> è«‹åœ¨ä»»æ„æ¬„ä½è¼¸å…¥å…§å®¹ï¼Œé€™è£¡æœƒé¡¯ç¤ºå¯¦æ™‚ç‹€æ…‹
            </div>
        </div>

        <!-- æ¸¬è©¦çµæœç¸½çµ -->
        <div class="test-section">
            <h3>ğŸ“‹ æ¸¬è©¦çµæœç¸½çµ</h3>
            <div id="testSummary"></div>
        </div>
    </div>

    <!-- å¼•å…¥ä¿®å¾©å¾Œçš„è…³æœ¬ -->
    <script src="static/js/enhanced_number_input.js"></script>
    
    <script>
        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹åˆå§‹åŒ–...');
            
            // åˆå§‹åŒ–æ‰€æœ‰æ¸¬è©¦æ¬„ä½
            const testInputs = [
                'basicDecimal', 'buyRate', 'sellRate',
                'edgeTest1', 'edgeTest2', 'edgeTest3'
            ];
            
            testInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    // ç‚ºåŒ¯ç‡æ¬„ä½è¨­ç½®ç‰¹æ®Šé¸é …
                    let options = { minDecimals: 0, maxDecimals: 2 };
                    
                    if (inputId.includes('Rate')) {
                        options.maxDecimals = 4; // åŒ¯ç‡æ¬„ä½æ”¯æŒ4ä½å°æ•¸
                    }
                    
                    setupNumberInputFormatting(input, options);
                    console.log(`âœ… å·²åˆå§‹åŒ– ${inputId} æ¬„ä½`);
                    
                    // æ·»åŠ ç„¦é»äº‹ä»¶ç›£è½
                    input.addEventListener('focus', function() {
                        this.parentElement.classList.add('focus');
                    });
                    
                    input.addEventListener('blur', function() {
                        this.parentElement.classList.remove('focus');
                    });
                }
            });
            
            console.log('ğŸ‰ æ‰€æœ‰æ¸¬è©¦æ¬„ä½åˆå§‹åŒ–å®Œæˆï¼');
        });

        // åŸºæœ¬å°æ•¸é»æ¸¬è©¦
        function testBasicDecimal() {
            const input = document.getElementById('basicDecimal');
            const resultDiv = document.getElementById('basicTestResult');
            
            if (!input.value) {
                resultDiv.innerHTML = 'è«‹å…ˆåœ¨æ¬„ä½ä¸­è¼¸å…¥ä¸€äº›å…§å®¹é€²è¡Œæ¸¬è©¦';
                resultDiv.className = 'test-result info';
                resultDiv.classList.remove('d-none');
                return;
            }
            
            const actualValue = input.getActualValue ? input.getActualValue() : input.value;
            const displayValue = input.value;
            
            let result = `é¡¯ç¤ºå€¼: ${displayValue}<br>å¯¦éš›å€¼: ${actualValue}<br><br>`;
            
            // åˆ†æè¼¸å…¥å…§å®¹
            if (displayValue.includes('.')) {
                result += 'âœ… åŒ…å«å°æ•¸é»<br>';
                if (displayValue.endsWith('.')) {
                    result += 'âœ… ä»¥å°æ•¸é»çµå°¾ï¼ˆæ­£ç¢ºï¼‰<br>';
                } else {
                    result += 'âœ… å°æ•¸é»åœ¨æ•¸å­—ä¸­é–“ï¼ˆæ­£ç¢ºï¼‰<br>';
                }
            } else {
                result += 'âŒ ä¸åŒ…å«å°æ•¸é»<br>';
            }
            
            if (displayValue.startsWith('.')) {
                result += 'âœ… ä»¥å°æ•¸é»é–‹é ­ï¼ˆæ­£ç¢ºï¼‰<br>';
            }
            
            resultDiv.innerHTML = result;
            resultDiv.className = 'test-result success';
            resultDiv.classList.remove('d-none');
        }

        // åŒ¯ç‡è¼¸å…¥æ¸¬è©¦
        function testRateInputs() {
            const resultDiv = document.getElementById('rateTestResult');
            let results = [];
            
            const rateInputs = ['buyRate', 'sellRate'];
            rateInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input.value) {
                    const actualValue = input.getActualValue ? input.getActualValue() : input.value;
                    results.push(`${input.placeholder}: ${input.value} â†’ å¯¦éš›å€¼: ${actualValue}`);
                }
            });
            
            if (results.length > 0) {
                resultDiv.innerHTML = results.join('<br>');
                resultDiv.className = 'test-result success';
                resultDiv.classList.remove('d-none');
            } else {
                resultDiv.innerHTML = 'è«‹å…ˆåœ¨åŒ¯ç‡æ¬„ä½è¼¸å…¥ä¸€äº›æ•¸å€¼é€²è¡Œæ¸¬è©¦';
                resultDiv.className = 'test-result info';
                resultDiv.classList.remove('d-none');
            }
        }

        // é‚Šç•Œæƒ…æ³æ¸¬è©¦
        function testEdgeCases() {
            const resultDiv = document.getElementById('edgeTestResult');
            let results = [];
            
            const edgeInputs = ['edgeTest1', 'edgeTest2', 'edgeTest3'];
            edgeInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input.value) {
                    const actualValue = input.getActualValue ? input.getActualValue() : input.value;
                    results.push(`${input.placeholder}: ${input.value} â†’ å¯¦éš›å€¼: ${actualValue}`);
                }
            });
            
            if (results.length > 0) {
                resultDiv.innerHTML = results.join('<br>');
                resultDiv.className = 'test-result success';
                resultDiv.classList.remove('d-none');
            } else {
                resultDiv.innerHTML = 'è«‹å…ˆåœ¨é‚Šç•Œæ¸¬è©¦æ¬„ä½è¼¸å…¥ä¸€äº›æ•¸å€¼é€²è¡Œæ¸¬è©¦';
                resultDiv.className = 'test-result info';
                resultDiv.classList.remove('d-none');
            }
        }

        // å¯¦æ™‚ç›£æ§æ‰€æœ‰è¼¸å…¥
        function updateRealTimeMonitor() {
            const allInputs = document.querySelectorAll('input[type="text"]');
            let results = [];
            
            allInputs.forEach(input => {
                if (input.value) {
                    const actualValue = input.getActualValue ? input.getActualValue() : input.value;
                    const displayValue = input.value;
                    
                    let status = '';
                    if (displayValue.includes('.')) {
                        if (displayValue.endsWith('.')) {
                            status = 'ğŸŸ¡ æ­£åœ¨è¼¸å…¥å°æ•¸é»';
                        } else if (displayValue.startsWith('.')) {
                            status = 'ğŸŸ¢ å°æ•¸é»é–‹é ­';
                        } else {
                            status = 'ğŸŸ¢ æ­£å¸¸å°æ•¸';
                        }
                    } else {
                        status = 'ğŸ”µ æ•´æ•¸';
                    }
                    
                    results.push(`${input.placeholder || input.id}: ${displayValue} (${status})`);
                }
            });
            
            if (results.length > 0) {
                document.getElementById('realTimeMonitor').innerHTML = `
                    <strong>å¯¦æ™‚ç‹€æ…‹ï¼š</strong><br>
                    ${results.join('<br>')}
                `;
            } else {
                document.getElementById('realTimeMonitor').innerHTML = `
                    <strong>å¯¦æ™‚ç‹€æ…‹ï¼š</strong> è«‹åœ¨ä»»æ„æ¬„ä½è¼¸å…¥å…§å®¹ï¼Œé€™è£¡æœƒé¡¯ç¤ºå¯¦æ™‚ç‹€æ…‹
                `;
            }
        }

        // ç‚ºæ‰€æœ‰è¼¸å…¥æ¬„ä½æ·»åŠ å¯¦æ™‚æ›´æ–°
        document.addEventListener('input', function(e) {
            if (e.target.type === 'text' && e.target.pattern) {
                setTimeout(updateRealTimeMonitor, 100);
            }
        });

        // å®šæœŸæ›´æ–°ç›£æ§
        setInterval(updateRealTimeMonitor, 1000);
    </script>
</body>
</html>
