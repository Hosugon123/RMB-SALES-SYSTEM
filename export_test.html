<!DOCTYPE html>
<html>
<head>
    <title>æ•¸æ“šåº«å°å‡ºæ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .status { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸ” æ•¸æ“šåº«å°å‡ºæ¸¬è©¦</h1>
    
    <p>é»æ“Šä¸‹é¢çš„æŒ‰éˆ•ä¾†å°å‡ºæ‚¨çš„æœ¬åœ°æ•¸æ“šåº«æ•¸æ“šï¼š</p>
    
    <button onclick="exportData()">ğŸ“¥ å°å‡ºæ•¸æ“šåº«æ•¸æ“š</button>
    <button onclick="downloadAsJson()">ğŸ’¾ ä¸‹è¼‰ç‚ºJSONæ–‡ä»¶</button>
    
    <div id="status"></div>
    <div id="result"></div>

    <script>
        let exportedData = null;
        
        async function exportData() {
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');
            
            statusDiv.innerHTML = '<div class="status">æ­£åœ¨å°å‡ºæ•¸æ“š...</div>';
            resultDiv.innerHTML = '';
            
            try {
                const response = await fetch('/api/export_database');
                
                if (response.ok) {
                    exportedData = await response.json();
                    
                    // é¡¯ç¤ºçµ±è¨ˆä¿¡æ¯
                    const stats = `
                        <div class="status success">
                            âœ… å°å‡ºæˆåŠŸï¼<br>
                            ğŸ‘¥ ç”¨æˆ¶: ${exportedData.users.length} å€‹<br>
                            ğŸ¢ æŒæœ‰äºº: ${exportedData.holders.length} å€‹<br>
                            ğŸ’° ç¾é‡‘å¸³æˆ¶: ${exportedData.cash_accounts.length} å€‹<br>
                            ğŸ‘¤ å®¢æˆ¶: ${exportedData.customers.length} å€‹<br>
                            ğŸ“¡ æ¸ é“: ${exportedData.channels.length} å€‹
                        </div>
                    `;
                    statusDiv.innerHTML = stats;
                    
                    // é¡¯ç¤ºè©³ç´°æ•¸æ“š
                    resultDiv.innerHTML = `
                        <h3>ğŸ“‹ å°å‡ºçš„æ•¸æ“šï¼š</h3>
                        <pre>${JSON.stringify(exportedData, null, 2)}</pre>
                    `;
                    
                } else {
                    const error = await response.text();
                    statusDiv.innerHTML = `<div class="status error">âŒ å°å‡ºå¤±æ•—: ${error}</div>`;
                }
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ è«‹æ±‚å¤±æ•—: ${error.message}</div>`;
            }
        }
        
        function downloadAsJson() {
            if (!exportedData) {
                alert('è«‹å…ˆå°å‡ºæ•¸æ“šï¼');
                return;
            }
            
            const dataStr = JSON.stringify(exportedData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `database_export_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
