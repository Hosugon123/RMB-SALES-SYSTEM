<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>提款類型功能測試</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="bi bi-arrow-up-circle me-2"></i>提款類型功能測試</h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h6><i class="bi bi-info-circle me-2"></i>新功能說明</h6>
                            <p>現在在資金操作中選擇「提出(-)」時，可以選擇提款類型：</p>
                            <ul>
                                <li><strong>利潤提款</strong> - 從累積利潤中提取資金</li>
                                <li><strong>資產提款</strong> - 從原始資產中提取資金</li>
                            </ul>
                        </div>

                        <div class="mb-4">
                            <h5>測試 1: 模擬資金操作模態框</h5>
                            <div class="border p-3 rounded bg-light">
                                <h6>操作類型</h6>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="test_is_decrease" id="testDeposit" value="false" checked>
                                    <label class="form-check-label" for="testDeposit">存入 (+)</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="test_is_decrease" id="testWithdraw" value="true">
                                    <label class="form-check-label" for="testWithdraw">提出 (-)</label>
                                </div>
                                
                                <div class="mt-3" id="testWithdrawTypeDiv" style="display: none;">
                                    <h6>提款類型</h6>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="test_withdraw_type" id="testWithdrawProfit" value="profit" checked>
                                        <label class="form-check-label text-success" for="testWithdrawProfit">
                                            <i class="bi bi-arrow-up-circle me-1"></i>利潤提款
                                        </label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="test_withdraw_type" id="testWithdrawAsset" value="asset">
                                        <label class="form-check-label text-warning" for="testWithdrawAsset">
                                            <i class="bi bi-arrow-down-circle me-1"></i>資產提款
                                        </label>
                                    </div>
                                    <small class="text-muted">利潤提款：從累積利潤中提取；資產提款：從原始資產中提取</small>
                                </div>
                            </div>
                            <div id="result1" class="mt-2 text-muted"></div>
                        </div>

                        <div class="mb-4">
                            <h5>測試 2: 後端處理邏輯</h5>
                            <button class="btn btn-primary" onclick="testBackendLogic()">測試後端邏輯</button>
                            <div id="result2" class="mt-2 text-muted"></div>
                        </div>

                        <div class="mb-4">
                            <h5>測試 3: 流水記錄類型</h5>
                            <button class="btn btn-primary" onclick="testLedgerEntryTypes()">測試流水記錄類型</button>
                            <div id="result3" class="mt-2 text-muted"></div>
                        </div>

                        <div class="alert alert-success">
                            <h6><i class="bi bi-check-circle me-2"></i>實現的功能</h6>
                            <ul class="mb-0">
                                <li>✅ 在資金操作模態框中添加提款類型選擇</li>
                                <li>✅ 利潤提款和資產提款的視覺區分（綠色 vs 黃色）</li>
                                <li>✅ 前端 JavaScript 邏輯處理顯示/隱藏</li>
                                <li>✅ 後端處理新的 <code>withdraw_type</code> 參數</li>
                                <li>✅ 不同的流水記錄類型：<code>PROFIT_WITHDRAW</code> vs <code>ASSET_WITHDRAW</code></li>
                                <li>✅ 不同的描述文本：「利潤提款」vs 「資產提款」</li>
                            </ul>
                        </div>

                        <div class="alert alert-warning">
                            <h6><i class="bi bi-exclamation-triangle me-2"></i>使用說明</h6>
                            <ol>
                                <li>在現金管理頁面點擊帳戶的「資金操作」按鈕</li>
                                <li>選擇「提出 (-)」操作類型</li>
                                <li>選擇提款類型：
                                    <ul>
                                        <li><strong>利潤提款</strong> - 適用於從交易利潤中提取資金</li>
                                        <li><strong>資產提款</strong> - 適用於從原始投資中提取資金</li>
                                    </ul>
                                </li>
                                <li>輸入提款金額和備註</li>
                                <li>點擊「確認執行」</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 測試操作類型選擇
        document.addEventListener('DOMContentLoaded', function() {
            const depositRadio = document.getElementById('testDeposit');
            const withdrawRadio = document.getElementById('testWithdraw');
            const withdrawTypeDiv = document.getElementById('testWithdrawTypeDiv');
            
            depositRadio.addEventListener('change', function() {
                if (this.checked) {
                    withdrawTypeDiv.style.display = 'none';
                    document.getElementById('result1').innerHTML = `
                        <div class="alert alert-info">
                            <strong>✅ 選擇存入操作</strong><br>
                            提款類型選擇欄位已隱藏
                        </div>
                    `;
                }
            });
            
            withdrawRadio.addEventListener('change', function() {
                if (this.checked) {
                    withdrawTypeDiv.style.display = 'block';
                    document.getElementById('result1').innerHTML = `
                        <div class="alert alert-success">
                            <strong>✅ 選擇提款操作</strong><br>
                            提款類型選擇欄位已顯示
                        </div>
                    `;
                }
            });
        });

        // 測試後端處理邏輯
        function testBackendLogic() {
            const testCases = [
                { withdraw_type: 'profit', expected_desc: '利潤提款' },
                { withdraw_type: 'asset', expected_desc: '資產提款' },
                { withdraw_type: '', expected_desc: '資產提款' }  // 默認值
            ];
            
            let result = `
                <div class="alert alert-info">
                    <h6>後端處理邏輯測試：</h6>
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>withdraw_type</th>
                                <th>預期描述</th>
                                <th>entry_type</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            testCases.forEach(testCase => {
                const entryType = testCase.withdraw_type === 'profit' ? 'PROFIT_WITHDRAW' : 'ASSET_WITHDRAW';
                result += `
                    <tr>
                        <td>${testCase.withdraw_type || '(空)'}</td>
                        <td>${testCase.expected_desc}</td>
                        <td>${entryType}</td>
                    </tr>
                `;
            });
            
            result += `
                        </tbody>
                    </table>
                    <p><strong>✅ 後端邏輯正確處理不同提款類型</strong></p>
                </div>
            `;
            
            document.getElementById('result2').innerHTML = result;
        }

        // 測試流水記錄類型
        function testLedgerEntryTypes() {
            const ledgerTypes = {
                'PROFIT_WITHDRAW': {
                    description: '利潤提款',
                    color: 'success',
                    icon: 'arrow-up-circle'
                },
                'ASSET_WITHDRAW': {
                    description: '資產提款',
                    color: 'warning',
                    icon: 'arrow-down-circle'
                }
            };
            
            let result = `
                <div class="alert alert-info">
                    <h6>流水記錄類型對照：</h6>
                    <div class="row">
            `;
            
            Object.keys(ledgerTypes).forEach(type => {
                const info = ledgerTypes[type];
                result += `
                    <div class="col-md-6 mb-2">
                        <div class="card border-${info.color}">
                            <div class="card-body p-2">
                                <h6 class="card-title text-${info.color}">
                                    <i class="bi bi-${info.icon} me-1"></i>${type}
                                </h6>
                                <p class="card-text small mb-0">${info.description}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            result += `
                    </div>
                    <p><strong>✅ 流水記錄類型正確區分利潤提款和資產提款</strong></p>
                </div>
            `;
            
            document.getElementById('result3').innerHTML = result;
        }
    </script>
</body>
</html>


