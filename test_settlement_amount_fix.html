<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŠ·å¸³é‡‘é¡é©—è­‰ä¿®å¾©æ¸¬è©¦</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="bi bi-bug me-2"></i>éŠ·å¸³é‡‘é¡é©—è­‰ä¿®å¾©æ¸¬è©¦</h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h6><i class="bi bi-info-circle me-2"></i>æ¸¬è©¦èªªæ˜</h6>
                            <p>æ­¤é é¢ç”¨æ–¼æ¸¬è©¦ä¿®å¾©å¾Œçš„éŠ·å¸³é‡‘é¡é©—è­‰åŠŸèƒ½ã€‚è«‹å˜—è©¦è¼¸å…¥ä¸åŒçš„é‡‘é¡å€¼ä¾†æ¸¬è©¦é©—è­‰é‚è¼¯ã€‚</p>
                        </div>

                        <div class="mb-4">
                            <h5>æ¸¬è©¦ 1: åŸºæœ¬æ•¸å­—è¼¸å…¥</h5>
                            <div class="mb-3">
                                <label for="testAmount1" class="form-label">éŠ·å¸³é‡‘é¡ (TWD)</label>
                                <input type="text" class="form-control" id="testAmount1" pattern="[0-9]*\.?[0-9]*" value="22500.00">
                                <small class="text-muted">è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—é‡‘é¡</small>
                            </div>
                            <button class="btn btn-primary" onclick="testValidation('testAmount1')">æ¸¬è©¦é©—è­‰</button>
                            <div id="result1" class="mt-2 text-muted"></div>
                        </div>

                        <div class="mb-4">
                            <h5>æ¸¬è©¦ 2: å°æ•¸é»è¼¸å…¥</h5>
                            <div class="mb-3">
                                <label for="testAmount2" class="form-label">éŠ·å¸³é‡‘é¡ (TWD)</label>
                                <input type="text" class="form-control" id="testAmount2" pattern="[0-9]*\.?[0-9]*" value="1234.56">
                                <small class="text-muted">è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—é‡‘é¡</small>
                            </div>
                            <button class="btn btn-primary" onclick="testValidation('testAmount2')">æ¸¬è©¦é©—è­‰</button>
                            <div id="result2" class="mt-2 text-muted"></div>
                        </div>

                        <div class="mb-4">
                            <h5>æ¸¬è©¦ 3: ç©ºå€¼æ¸¬è©¦</h5>
                            <div class="mb-3">
                                <label for="testAmount3" class="form-label">éŠ·å¸³é‡‘é¡ (TWD)</label>
                                <input type="text" class="form-control" id="testAmount3" pattern="[0-9]*\.?[0-9]*" value="">
                                <small class="text-muted">è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—é‡‘é¡</small>
                            </div>
                            <button class="btn btn-primary" onclick="testValidation('testAmount3')">æ¸¬è©¦é©—è­‰</button>
                            <div id="result3" class="mt-2 text-muted"></div>
                        </div>

                        <div class="mb-4">
                            <h5>æ¸¬è©¦ 4: ç„¡æ•ˆè¼¸å…¥æ¸¬è©¦</h5>
                            <div class="mb-3">
                                <label for="testAmount4" class="form-label">éŠ·å¸³é‡‘é¡ (TWD)</label>
                                <input type="text" class="form-control" id="testAmount4" pattern="[0-9]*\.?[0-9]*" value="abc123">
                                <small class="text-muted">è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—é‡‘é¡</small>
                            </div>
                            <button class="btn btn-primary" onclick="testValidation('testAmount4')">æ¸¬è©¦é©—è­‰</button>
                            <div id="result4" class="mt-2 text-muted"></div>
                        </div>

                        <div class="alert alert-success">
                            <h6><i class="bi bi-check-circle me-2"></i>ä¿®å¾©å…§å®¹</h6>
                            <ul class="mb-0">
                                <li>å°‡éŠ·å¸³é‡‘é¡è¼¸å…¥æ¡†å¾ <code>type="number"</code> æ”¹ç‚º <code>type="text"</code></li>
                                <li>æ·»åŠ æ•¸å­—æ ¼å¼åŒ–åŠŸèƒ½æ”¯æŒ</li>
                                <li>æ”¹é€²æ•¸å­—è§£æé‚è¼¯ï¼Œå„ªå…ˆä½¿ç”¨ <code>getActualValue()</code> æ–¹æ³•</li>
                                <li>å¢åŠ è©³ç´°çš„èª¿è©¦æ—¥èªŒè¼¸å‡º</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥æ•¸å­—æ ¼å¼åŒ–è…³æœ¬ -->
    <script src="static/js/enhanced_number_input.js"></script>
    
    <script>
        // æ¸¬è©¦é©—è­‰å‡½æ•¸
        function testValidation(inputId) {
            const input = document.getElementById(inputId);
            const resultDiv = document.getElementById(inputId.replace('testAmount', 'result'));
            
            console.log('ğŸ” æ¸¬è©¦è¼¸å…¥æ¡†ä¿¡æ¯:', {
                id: inputId,
                type: input.type,
                value: input.value,
                hasGetActualValue: !!input.getActualValue
            });
            
            // ä½¿ç”¨ä¿®å¾©å¾Œçš„é©—è­‰é‚è¼¯
            let settlementAmount;
            
            // å„ªå…ˆä½¿ç”¨ getActualValue æ–¹æ³•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå¦å‰‡ç›´æ¥è§£æ value
            if (input.getActualValue) {
                settlementAmount = parseFloat(input.getActualValue());
                console.log('ä½¿ç”¨ getActualValue æ–¹æ³•:', input.getActualValue());
            } else {
                // ç§»é™¤æ ¼å¼åŒ–å­—ç¬¦å¾Œè§£æ
                const rawValue = input.value.replace(/[^0-9.-]/g, '');
                settlementAmount = parseFloat(rawValue);
                console.log('ä½¿ç”¨ value è§£æ:', rawValue);
            }
            
            console.log('ğŸ” è§£æå¾Œçš„éŠ·å¸³é‡‘é¡:', settlementAmount);
            
            // é©—è­‰é‚è¼¯
            let validationResult = '';
            let isValid = true;
            
            if (!settlementAmount || settlementAmount <= 0 || isNaN(settlementAmount)) {
                validationResult = 'âŒ è«‹è¼¸å…¥æœ‰æ•ˆçš„éŠ·å¸³é‡‘é¡';
                isValid = false;
            } else {
                validationResult = `âœ… æœ‰æ•ˆé‡‘é¡: NT$ ${settlementAmount.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            }
            
            resultDiv.innerHTML = validationResult;
            resultDiv.className = `mt-2 ${isValid ? 'text-success' : 'text-danger'}`;
            
            // é¡¯ç¤º SweetAlert çµæœ
            if (isValid) {
                Swal.fire('é©—è­‰æˆåŠŸ', `é‡‘é¡: NT$ ${settlementAmount.toLocaleString('en-US', {minimumFractionDigits: 2})}`, 'success');
            } else {
                Swal.fire('éŒ¯èª¤', 'è«‹è¼¸å…¥æœ‰æ•ˆçš„éŠ·å¸³é‡‘é¡', 'error');
            }
        }

        // åˆå§‹åŒ–æ•¸å­—æ ¼å¼åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('åˆå§‹åŒ–æ•¸å­—æ ¼å¼åŒ–...');
            
            // ç‚ºæ‰€æœ‰æ¸¬è©¦è¼¸å…¥æ¡†æ‡‰ç”¨æ•¸å­—æ ¼å¼åŒ–
            const inputs = ['testAmount1', 'testAmount2', 'testAmount3', 'testAmount4'];
            inputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input && typeof setupNumberInputFormatting === 'function') {
                    setupNumberInputFormatting(input, { maxDecimals: 2 });
                    console.log(`âœ… ${inputId} æ•¸å­—æ ¼å¼åŒ–å·²æ‡‰ç”¨`);
                }
            });
            
            console.log('âœ… æ¸¬è©¦é é¢åˆå§‹åŒ–å®Œæˆ');
        });
    </script>
</body>
</html>




