<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ¯ç‡æ¬„ä½å°æ•¸é»è¼¸å…¥æ¸¬è©¦</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-section {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #f8f9fa;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">ğŸ”§ åŒ¯ç‡æ¬„ä½å°æ•¸é»è¼¸å…¥ä¿®å¾©æ¸¬è©¦</h1>
        
        <div class="alert alert-info">
            <strong>æ¸¬è©¦ç›®çš„ï¼š</strong> é©—è­‰åŒ¯ç‡æ¬„ä½ç¾åœ¨å¯ä»¥æ­£å¸¸è¼¸å…¥å°æ•¸é»ï¼Œè§£æ±ºä¹‹å‰çš„è¼¸å…¥å•é¡Œã€‚
        </div>

        <!-- åŒ¯ç‡è¼¸å…¥æ¸¬è©¦ -->
        <div class="test-section">
            <h3>ğŸ“Š åŒ¯ç‡è¼¸å…¥æ¸¬è©¦</h3>
            <p>æ¸¬è©¦åŒ¯ç‡æ¬„ä½çš„å°æ•¸é»è¼¸å…¥åŠŸèƒ½ï¼š</p>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="buyRate" class="form-label">è²·å…¥åŒ¯ç‡</label>
                        <input type="text" class="form-control" id="buyRate" 
                               pattern="[0-9]*\.?[0-9]*" placeholder="ä¾‹å¦‚: 4.5000">
                        <small class="text-muted">å˜—è©¦è¼¸å…¥: 4.5, 4.50, 4.500, 4.5000</small>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="sellRate" class="form-label">è³£å‡ºåŒ¯ç‡</label>
                        <input type="text" class="form-control" id="sellRate" 
                               pattern="[0-9]*\.?[0-9]*" placeholder="ä¾‹å¦‚: 4.6000">
                        <small class="text-muted">å˜—è©¦è¼¸å…¥: 4.6, 4.60, 4.600, 4.6000</small>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label for="exchangeRate" class="form-label">ä¸€èˆ¬åŒ¯ç‡</label>
                <input type="text" class="form-control" id="exchangeRate" 
                       pattern="[0-9]*\.?[0-9]*" placeholder="ä¾‹å¦‚: 4.5500">
                <small class="text-muted">å˜—è©¦è¼¸å…¥: 4.55, 4.550, 4.5500</small>
            </div>

            <button class="btn btn-primary" onclick="testRateInputs()">ğŸ§ª æ¸¬è©¦åŒ¯ç‡è¼¸å…¥</button>
            <div id="rateTestResult" class="test-result d-none"></div>
        </div>

        <!-- å°æ•¸é»è¼¸å…¥æ¸¬è©¦ -->
        <div class="test-section">
            <h3>ğŸ”¢ å°æ•¸é»è¼¸å…¥æ¸¬è©¦</h3>
            <p>æ¸¬è©¦å„ç¨®å°æ•¸é»è¼¸å…¥æƒ…æ³ï¼š</p>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="decimalTest1" class="form-label">æ¸¬è©¦ 1: å–®ç¨å°æ•¸é»</label>
                        <input type="text" class="form-control" id="decimalTest1" 
                               pattern="[0-9]*\.?[0-9]*" placeholder="è¼¸å…¥ .">
                        <small class="text-muted">è¼¸å…¥ . ç„¶å¾Œè¼¸å…¥æ•¸å­—</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="decimalTest2" class="form-label">æ¸¬è©¦ 2: æ•¸å­—å¾Œå°æ•¸é»</label>
                        <input type="text" class="form-control" id="decimalTest2" 
                               pattern="[0-9]*\.?[0-9]*" placeholder="è¼¸å…¥ 4.">
                        <small class="text-muted">è¼¸å…¥ 4. ç„¶å¾Œè¼¸å…¥æ•¸å­—</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="decimalTest3" class="form-label">æ¸¬è©¦ 3: å®Œæ•´å°æ•¸</label>
                        <input type="text" class="form-control" id="decimalTest3" 
                               pattern="[0-9]*\.?[0-9]*" placeholder="è¼¸å…¥ 4.55">
                        <small class="text-muted">ç›´æ¥è¼¸å…¥ 4.55</small>
                    </div>
                </div>
            </div>

            <button class="btn btn-success" onclick="testDecimalInputs()">ğŸ§ª æ¸¬è©¦å°æ•¸é»è¼¸å…¥</button>
            <div id="decimalTestResult" class="test-result d-none"></div>
        </div>

        <!-- åŠŸèƒ½é©—è­‰ -->
        <div class="test-section">
            <h3>âœ… åŠŸèƒ½é©—è­‰</h3>
            <p>é©—è­‰ä¿®å¾©å¾Œçš„åŠŸèƒ½ï¼š</p>
            
            <div class="row">
                <div class="col-md-6">
                    <h5>æ‡‰è©²èƒ½æ­£å¸¸å·¥ä½œçš„æƒ…æ³ï¼š</h5>
                    <ul class="text-success">
                        <li>âœ… è¼¸å…¥å–®ç¨çš„å°æ•¸é» (.)</li>
                        <li>âœ… è¼¸å…¥æ•¸å­—å¾Œçš„å°æ•¸é» (4.)</li>
                        <li>âœ… è¼¸å…¥å®Œæ•´å°æ•¸ (4.55)</li>
                        <li>âœ… è¼¸å…¥å¤šä½å°æ•¸ (4.5500)</li>
                        <li>âœ… åˆªé™¤å’Œä¿®æ”¹å°æ•¸é»</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>æ‡‰è©²è¢«é˜»æ­¢çš„æƒ…æ³ï¼š</h5>
                    <ul class="text-danger">
                        <li>âŒ è¼¸å…¥å¤šå€‹å°æ•¸é» (4.5.5)</li>
                        <li>âŒ è¼¸å…¥éæ•¸å­—å­—ç¬¦ (4.5a)</li>
                        <li>âŒ è¼¸å…¥ç‰¹æ®Šç¬¦è™Ÿ (4.5@)</li>
                    </ul>
                </div>
            </div>

            <button class="btn btn-info" onclick="runAllTests()">ğŸš€ åŸ·è¡Œå®Œæ•´æ¸¬è©¦</button>
            <div id="fullTestResult" class="test-result d-none"></div>
        </div>

        <!-- æ¸¬è©¦çµæœé¡¯ç¤º -->
        <div class="test-section">
            <h3>ğŸ“Š æ¸¬è©¦çµæœ</h3>
            <div id="testResults"></div>
        </div>
    </div>

    <!-- å¼•å…¥ä¿®å¾©å¾Œçš„è…³æœ¬ -->
    <script src="static/js/enhanced_number_input.js"></script>
    
    <script>
        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹åˆå§‹åŒ–...');
            
            // åˆå§‹åŒ–æ‰€æœ‰æ¸¬è©¦æ¬„ä½
            const testInputs = [
                'buyRate', 'sellRate', 'exchangeRate',
                'decimalTest1', 'decimalTest2', 'decimalTest3'
            ];
            
            testInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    // ç‚ºåŒ¯ç‡æ¬„ä½è¨­ç½®ç‰¹æ®Šé¸é …
                    let options = { minDecimals: 0, maxDecimals: 2 };
                    
                    if (inputId.includes('Rate') || inputId.includes('exchange')) {
                        options.maxDecimals = 4; // åŒ¯ç‡æ¬„ä½æ”¯æŒ4ä½å°æ•¸
                    }
                    
                    setupNumberInputFormatting(input, options);
                    console.log(`âœ… å·²åˆå§‹åŒ– ${inputId} æ¬„ä½`);
                }
            });
            
            console.log('ğŸ‰ æ‰€æœ‰æ¸¬è©¦æ¬„ä½åˆå§‹åŒ–å®Œæˆï¼');
        });

        // æ¸¬è©¦åŒ¯ç‡è¼¸å…¥åŠŸèƒ½
        function testRateInputs() {
            const resultDiv = document.getElementById('rateTestResult');
            let results = [];
            
            // æ¸¬è©¦è²·å…¥åŒ¯ç‡
            const buyRate = document.getElementById('buyRate');
            if (buyRate.value) {
                const actualValue = buyRate.getActualValue ? buyRate.getActualValue() : buyRate.value;
                results.push(`è²·å…¥åŒ¯ç‡: ${buyRate.value} â†’ å¯¦éš›å€¼: ${actualValue}`);
            }
            
            // æ¸¬è©¦è³£å‡ºåŒ¯ç‡
            const sellRate = document.getElementById('sellRate');
            if (sellRate.value) {
                const actualValue = sellRate.getActualValue ? sellRate.getActualValue() : sellRate.value;
                results.push(`è³£å‡ºåŒ¯ç‡: ${sellRate.value} â†’ å¯¦éš›å€¼: ${actualValue}`);
            }
            
            // æ¸¬è©¦ä¸€èˆ¬åŒ¯ç‡
            const exchangeRate = document.getElementById('exchangeRate');
            if (exchangeRate.value) {
                const actualValue = exchangeRate.getActualValue ? exchangeRate.getActualValue() : exchangeRate.value;
                results.push(`ä¸€èˆ¬åŒ¯ç‡: ${exchangeRate.value} â†’ å¯¦éš›å€¼: ${actualValue}`);
            }
            
            if (results.length > 0) {
                resultDiv.innerHTML = results.join('<br>');
                resultDiv.className = 'test-result success';
                resultDiv.classList.remove('d-none');
            } else {
                resultDiv.innerHTML = 'è«‹å…ˆåœ¨åŒ¯ç‡æ¬„ä½è¼¸å…¥ä¸€äº›æ•¸å€¼é€²è¡Œæ¸¬è©¦';
                resultDiv.className = 'test-result info';
                resultDiv.classList.remove('d-none');
            }
        }

        // æ¸¬è©¦å°æ•¸é»è¼¸å…¥åŠŸèƒ½
        function testDecimalInputs() {
            const resultDiv = document.getElementById('decimalTestResult');
            let results = [];
            
            // æ¸¬è©¦å„ç¨®å°æ•¸é»è¼¸å…¥æƒ…æ³
            const testCases = [
                { id: 'decimalTest1', name: 'å–®ç¨å°æ•¸é»' },
                { id: 'decimalTest2', name: 'æ•¸å­—å¾Œå°æ•¸é»' },
                { id: 'decimalTest3', name: 'å®Œæ•´å°æ•¸' }
            ];
            
            testCases.forEach(testCase => {
                const input = document.getElementById(testCase.id);
                if (input.value) {
                    const actualValue = input.getActualValue ? input.getActualValue() : input.value;
                    results.push(`${testCase.name}: ${input.value} â†’ å¯¦éš›å€¼: ${actualValue}`);
                }
            });
            
            if (results.length > 0) {
                resultDiv.innerHTML = results.join('<br>');
                resultDiv.className = 'test-result success';
                resultDiv.classList.remove('d-none');
            } else {
                resultDiv.innerHTML = 'è«‹å…ˆåœ¨å°æ•¸é»æ¸¬è©¦æ¬„ä½è¼¸å…¥ä¸€äº›æ•¸å€¼é€²è¡Œæ¸¬è©¦';
                resultDiv.className = 'test-result info';
                resultDiv.classList.remove('d-none');
            }
        }

        // åŸ·è¡Œå®Œæ•´æ¸¬è©¦
        function runAllTests() {
            const resultDiv = document.getElementById('fullTestResult');
            let allResults = [];
            
            // æ”¶é›†æ‰€æœ‰æ¸¬è©¦çµæœ
            const allInputs = document.querySelectorAll('input[type="text"]');
            allInputs.forEach(input => {
                if (input.value) {
                    const actualValue = input.getActualValue ? input.getActualValue() : input.value;
                    const displayValue = input.value;
                    allResults.push(`${input.placeholder || input.id}: ${displayValue} â†’ å¯¦éš›å€¼: ${actualValue}`);
                }
            });
            
            if (allResults.length > 0) {
                resultDiv.innerHTML = '<strong>å®Œæ•´æ¸¬è©¦çµæœï¼š</strong><br>' + allResults.join('<br>');
                resultDiv.className = 'test-result success';
                resultDiv.classList.remove('d-none');
                
                // æ›´æ–°æ¸¬è©¦çµæœå€åŸŸ
                document.getElementById('testResults').innerHTML = `
                    <div class="alert alert-success">
                        <h5>ğŸ‰ æ¸¬è©¦å®Œæˆï¼</h5>
                        <p>å…±æ¸¬è©¦äº† ${allResults.length} å€‹æ¬„ä½ï¼Œæ‰€æœ‰æ¬„ä½éƒ½èƒ½æ­£å¸¸è™•ç†å°æ•¸é»è¼¸å…¥ã€‚</p>
                        <hr>
                        <h6>è©³ç´°çµæœï¼š</h6>
                        ${allResults.join('<br>')}
                    </div>
                `;
            } else {
                resultDiv.innerHTML = 'è«‹å…ˆåœ¨å„ç¨®æ¬„ä½è¼¸å…¥æ•¸å€¼é€²è¡Œæ¸¬è©¦';
                resultDiv.className = 'test-result info';
                resultDiv.classList.remove('d-none');
            }
        }

        // æ·»åŠ å¯¦æ™‚æ¸¬è©¦çµæœé¡¯ç¤º
        function updateTestResults() {
            const allInputs = document.querySelectorAll('input[type="text"]');
            let results = [];
            
            allInputs.forEach(input => {
                if (input.value) {
                    const actualValue = input.getActualValue ? input.getActualValue() : input.value;
                    results.push(`${input.placeholder || input.id}: ${input.value} â†’ ${actualValue}`);
                }
            });
            
            if (results.length > 0) {
                document.getElementById('testResults').innerHTML = `
                    <div class="alert alert-info">
                        <h6>å¯¦æ™‚æ¸¬è©¦çµæœï¼š</h6>
                        ${results.join('<br>')}
                    </div>
                `;
            }
        }

        // ç‚ºæ‰€æœ‰è¼¸å…¥æ¬„ä½æ·»åŠ å¯¦æ™‚æ›´æ–°
        document.addEventListener('input', function(e) {
            if (e.target.type === 'text' && e.target.pattern) {
                setTimeout(updateTestResults, 100);
            }
        });
    </script>
</body>
</html>
