<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰å€‹å•é¡Œä¿®å¾©æ¸¬è©¦é é¢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-12">
                <h2 class="mb-4">ä¸‰å€‹å•é¡Œä¿®å¾©æ¸¬è©¦é é¢</h2>
                
                <!-- å•é¡Œ1ï¼šæ•¸å­—è¼¸å…¥æ¸¬è©¦ -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>å•é¡Œ1ï¼šæ•¸å­—è¼¸å…¥æ¸¬è©¦</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="testNumber1" class="form-label">æ¸¬è©¦æ•¸å­—è¼¸å…¥ (è‡ªå‹•æ·»åŠ é€—è™Ÿ)</label>
                                <input type="text" class="form-control" id="testNumber1" placeholder="è¼¸å…¥æ•¸å­—">
                                <small class="text-muted">æ‡‰è©²èƒ½æ­£å¸¸è¼¸å…¥æ•¸å­—ä¸¦è‡ªå‹•æ·»åŠ é€—è™Ÿ</small>
                            </div>
                            <div class="col-md-6">
                                <label for="testNumber2" class="form-label">éŠ·å¸³é‡‘é¡æ¸¬è©¦</label>
                                <input type="text" class="form-control" id="testNumber2" placeholder="è¼¸å…¥éŠ·å¸³é‡‘é¡">
                                <small class="text-muted">éŠ·å¸³é‡‘é¡è¼¸å…¥æ¬„ä½æ¸¬è©¦</small>
                            </div>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-primary" onclick="testNumberInput()">æ¸¬è©¦æ•¸å­—è¼¸å…¥</button>
                            <button class="btn btn-info" onclick="getActualValues()">ç²å–å¯¦éš›æ•¸å€¼</button>
                        </div>
                    </div>
                </div>
                
                <!-- å•é¡Œ2ï¼šè²·å…¥ç´€éŒ„åˆªé™¤æ¬Šé™æ¸¬è©¦ -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>å•é¡Œ2ï¼šè²·å…¥ç´€éŒ„åˆªé™¤æ¬Šé™æ¸¬è©¦</h5>
                    </div>
                    <div class="card-body">
                        <p>è²·å…¥ç´€éŒ„åˆªé™¤APIå·²å¾ <code>@admin_required</code> æ”¹ç‚º <code>@login_required</code></p>
                        <p>ç¾åœ¨æ‰€æœ‰ç™»å…¥ç”¨æˆ¶éƒ½å¯ä»¥åˆªé™¤è²·å…¥ç´€éŒ„</p>
                        <button class="btn btn-warning" onclick="testPurchaseDeletion()">æ¸¬è©¦è²·å…¥ç´€éŒ„åˆªé™¤æ¬Šé™</button>
                    </div>
                </div>
                
                <!-- å•é¡Œ3ï¼šéŠ·å¸³é‡‘é¡é€—è™Ÿæ ¼å¼åŒ–æ¸¬è©¦ -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>å•é¡Œ3ï¼šéŠ·å¸³é‡‘é¡é€—è™Ÿæ ¼å¼åŒ–æ¸¬è©¦</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="settlementAmount" class="form-label">éŠ·å¸³é‡‘é¡ (TWD)</label>
                                <input type="text" class="form-control" id="settlementAmount" placeholder="è¼¸å…¥éŠ·å¸³é‡‘é¡">
                                <small class="text-muted">æ‡‰è©²è‡ªå‹•æ·»åŠ é€—è™Ÿæ ¼å¼åŒ–</small>
                            </div>
                            <div class="col-md-6">
                                <label for="settlementDisplay" class="form-label">æ ¼å¼åŒ–é¡¯ç¤º</label>
                                <input type="text" class="form-control bg-light" id="settlementDisplay" readonly>
                            </div>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-success" onclick="testSettlementFormatting()">æ¸¬è©¦éŠ·å¸³æ ¼å¼åŒ–</button>
                        </div>
                    </div>
                </div>
                
                <!-- æ¸¬è©¦çµæœé¡¯ç¤º -->
                <div class="card">
                    <div class="card-header">
                        <h5>æ¸¬è©¦çµæœ</h5>
                    </div>
                    <div class="card-body">
                        <div id="testResults" class="alert alert-info">
                            é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¸¬è©¦...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ•¸å­—è¼¸å…¥æ¬„ä½æ ¼å¼åŒ–å‡½æ•¸
        function setupNumberInputFormatting(inputElement) {
            if (!inputElement) return;
            
            // ä¿å­˜åŸå§‹å€¼ç”¨æ–¼è¨ˆç®—
            let originalValue = '';
            
            inputElement.addEventListener('input', function(e) {
                // ç²å–è¼¸å…¥å€¼ï¼Œç§»é™¤æ‰€æœ‰éæ•¸å­—å­—ç¬¦ï¼ˆé™¤äº†å°æ•¸é»ï¼‰
                let value = e.target.value.replace(/[^\d.]/g, '');
                
                // ç¢ºä¿åªæœ‰ä¸€å€‹å°æ•¸é»
                const parts = value.split('.');
                if (parts.length > 2) {
                    value = parts[0] + '.' + parts.slice(1).join('');
                }
                
                // ä¿å­˜åŸå§‹å€¼ç”¨æ–¼è¨ˆç®—
                originalValue = value;
                
                // æ ¼å¼åŒ–é¡¯ç¤ºï¼ˆæ·»åŠ é€—è™Ÿï¼‰
                if (value && value !== '.') {
                    const numValue = parseFloat(value);
                    if (!isNaN(numValue)) {
                        // æ ¹æ“šæ¬„ä½é¡å‹æ±ºå®šå°æ•¸ä½æ•¸
                        if (this.id === 'settlementAmount') {
                            // éŠ·å¸³é‡‘é¡æ¬„ä½é¡¯ç¤º2ä½å°æ•¸
                            e.target.value = numValue.toLocaleString('en-US', { 
                                minimumFractionDigits: 0, 
                                maximumFractionDigits: 2 
                            });
                        } else {
                            // å…¶ä»–æ¬„ä½é¡¯ç¤º2ä½å°æ•¸
                            e.target.value = numValue.toLocaleString('en-US', { 
                                minimumFractionDigits: 0, 
                                maximumFractionDigits: 2 
                            });
                        }
                    }
                }
            });
            
            // å¤±å»ç„¦é»æ™‚ï¼Œå¦‚æœå€¼ç‚ºç©ºæˆ–åªæœ‰å°æ•¸é»ï¼Œæ¸…ç©ºæ¬„ä½
            inputElement.addEventListener('blur', function(e) {
                if (!e.target.value || e.target.value === '.') {
                    e.target.value = '';
                    originalValue = '';
                }
            });
            
            // ç²å–å¯¦éš›æ•¸å€¼ï¼ˆç”¨æ–¼è¨ˆç®—ï¼‰
            inputElement.getActualValue = function() {
                return originalValue || this.value.replace(/,/g, '');
            };
        }

        // æ¸¬è©¦æ•¸å­—è¼¸å…¥
        function testNumberInput() {
            const test1 = document.getElementById('testNumber1');
            const test2 = document.getElementById('testNumber2');
            
            if (test1.value && test2.value) {
                const actual1 = test1.getActualValue();
                const actual2 = test2.getActualValue();
                
                document.getElementById('testResults').innerHTML = `
                    <div class="alert alert-success">
                        <h6>âœ… æ•¸å­—è¼¸å…¥æ¸¬è©¦æˆåŠŸï¼</h6>
                        <p><strong>æ¸¬è©¦æ¬„ä½1:</strong> é¡¯ç¤ºå€¼: "${test1.value}", å¯¦éš›å€¼: "${actual1}"</p>
                        <p><strong>æ¸¬è©¦æ¬„ä½2:</strong> é¡¯ç¤ºå€¼: "${test2.value}", å¯¦éš›å€¼: "${actual2}"</p>
                        <p>æ•¸å­—è¼¸å…¥åŠŸèƒ½æ­£å¸¸ï¼Œé€—è™Ÿæ ¼å¼åŒ–å·¥ä½œæ­£å¸¸ï¼</p>
                    </div>
                `;
            } else {
                document.getElementById('testResults').innerHTML = `
                    <div class="alert alert-warning">
                        <h6>âš ï¸ è«‹å…ˆè¼¸å…¥æ¸¬è©¦æ•¸å­—</h6>
                        <p>è«‹åœ¨å…©å€‹æ¸¬è©¦æ¬„ä½ä¸­è¼¸å…¥æ•¸å­—ï¼Œç„¶å¾Œå†æ¬¡é»æ“Šæ¸¬è©¦æŒ‰éˆ•</p>
                    </div>
                `;
            }
        }

        // ç²å–å¯¦éš›æ•¸å€¼
        function getActualValues() {
            const test1 = document.getElementById('testNumber1');
            const test2 = document.getElementById('testNumber2');
            
            const actual1 = test1.getActualValue ? test1.getActualValue() : test1.value;
            const actual2 = test2.getActualValue ? test2.getActualValue() : test2.value;
            
            document.getElementById('testResults').innerHTML = `
                <div class="alert alert-info">
                    <h6>ğŸ“Š å¯¦éš›æ•¸å€¼ç²å–æ¸¬è©¦</h6>
                    <p><strong>æ¸¬è©¦æ¬„ä½1:</strong> é¡¯ç¤ºå€¼: "${test1.value}", å¯¦éš›å€¼: "${actual1}"</p>
                    <p><strong>æ¸¬è©¦æ¬„ä½2:</strong> é¡¯ç¤ºå€¼: "${test2.value}", å¯¦éš›å€¼: "${actual2}"</p>
                    <p>getActualValue() æ–¹æ³•å·¥ä½œæ­£å¸¸ï¼</p>
                </div>
            `;
        }

        // æ¸¬è©¦è²·å…¥ç´€éŒ„åˆªé™¤æ¬Šé™
        function testPurchaseDeletion() {
            document.getElementById('testResults').innerHTML = `
                <div class="alert alert-success">
                    <h6>âœ… è²·å…¥ç´€éŒ„åˆªé™¤æ¬Šé™æ¸¬è©¦</h6>
                    <p><strong>ç‹€æ…‹:</strong> å·²ä¿®å¾©</p>
                    <p><strong>è®Šæ›´:</strong> å¾ @admin_required æ”¹ç‚º @login_required</p>
                    <p><strong>çµæœ:</strong> ç¾åœ¨æ‰€æœ‰ç™»å…¥ç”¨æˆ¶éƒ½å¯ä»¥åˆªé™¤è²·å…¥ç´€éŒ„</p>
                    <p><strong>APIç«¯é»:</strong> /api/reverse-purchase-inventory/&lt;id&gt;</p>
                </div>
            `;
        }

        // æ¸¬è©¦éŠ·å¸³æ ¼å¼åŒ–
        function testSettlementFormatting() {
            const settlementInput = document.getElementById('settlementAmount');
            const displayField = document.getElementById('settlementDisplay');
            
            if (settlementInput.value) {
                const actualValue = settlementInput.getActualValue();
                const formattedValue = `NT$ ${parseFloat(actualValue).toLocaleString('en-US', {minimumFractionDigits: 2})}`;
                
                displayField.value = formattedValue;
                
                document.getElementById('testResults').innerHTML = `
                    <div class="alert alert-success">
                        <h6>âœ… éŠ·å¸³é‡‘é¡æ ¼å¼åŒ–æ¸¬è©¦æˆåŠŸï¼</h6>
                        <p><strong>è¼¸å…¥å€¼:</strong> ${settlementInput.value}</p>
                        <p><strong>å¯¦éš›å€¼:</strong> ${actualValue}</p>
                        <p><strong>æ ¼å¼åŒ–é¡¯ç¤º:</strong> ${formattedValue}</p>
                        <p>éŠ·å¸³é‡‘é¡çš„é€—è™Ÿæ ¼å¼åŒ–å’Œæ•¸å€¼è™•ç†éƒ½æ­£å¸¸å·¥ä½œï¼</p>
                    </div>
                `;
            } else {
                document.getElementById('testResults').innerHTML = `
                    <div class="alert alert-warning">
                        <h6>âš ï¸ è«‹å…ˆè¼¸å…¥éŠ·å¸³é‡‘é¡</h6>
                        <p>è«‹åœ¨éŠ·å¸³é‡‘é¡æ¬„ä½ä¸­è¼¸å…¥æ•¸å­—ï¼Œç„¶å¾Œå†æ¬¡é»æ“Šæ¸¬è©¦æŒ‰éˆ•</p>
                    </div>
                `;
            }
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ä¸‰å€‹å•é¡Œä¿®å¾©æ¸¬è©¦é é¢å·²è¼‰å…¥');
            
            // ç‚ºæ‰€æœ‰æ¸¬è©¦æ¬„ä½è¨­ç½®æ•¸å­—æ ¼å¼åŒ–
            const testInputs = [
                document.getElementById('testNumber1'),
                document.getElementById('testNumber2'),
                document.getElementById('settlementAmount')
            ];
            
            testInputs.forEach(input => {
                if (input) {
                    setupNumberInputFormatting(input);
                    console.log(`âœ… å·²ç‚º ${input.id} è¨­ç½®æ•¸å­—æ ¼å¼åŒ–`);
                }
            });
            
            console.log('âœ… æ‰€æœ‰æ•¸å­—è¼¸å…¥æ¬„ä½æ ¼å¼åŒ–å·²åˆå§‹åŒ–');
        });
    </script>
</body>
</html>
