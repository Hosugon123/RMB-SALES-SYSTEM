<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŠ·å¸³é‡‘é¡é©—è­‰ä¿®å¾©æ¸¬è©¦</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
</head>
<body>
    <div class="container mt-5">
        <h1>éŠ·å¸³é‡‘é¡é©—è­‰ä¿®å¾©æ¸¬è©¦</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>æ¸¬è©¦éŠ·å¸³é‡‘é¡è§£æ</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="testAmount" class="form-label">æ¸¬è©¦é‡‘é¡</label>
                            <input type="text" class="form-control" id="testAmount" 
                                   value="22500" pattern="[0-9]*\.?[0-9]*">
                        </div>
                        <button class="btn btn-primary" onclick="testAmountParsing()">æ¸¬è©¦è§£æ</button>
                        <div id="parsingResult" class="mt-3"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>æ¸¬è©¦é©—è­‰é‚è¼¯</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="validationAmount" class="form-label">é©—è­‰é‡‘é¡</label>
                            <input type="text" class="form-control" id="validationAmount" 
                                   value="" pattern="[0-9]*\.?[0-9]*">
                        </div>
                        <button class="btn btn-warning" onclick="testValidation()">æ¸¬è©¦é©—è­‰</button>
                        <div id="validationResult" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>æ§åˆ¶å°æ—¥èªŒ</h5>
                    </div>
                    <div class="card-body">
                        <div id="consoleLog" class="bg-dark text-light p-3" style="height: 300px; overflow-y: auto; font-family: monospace;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="static/js/enhanced_number_input.js"></script>
    <script>
        // æ¨¡æ“¬æ§åˆ¶å°æ—¥èªŒ
        function logToPage(message, type = 'info') {
            const consoleDiv = document.getElementById('consoleLog');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'white';
            consoleDiv.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        // é‡å¯« console.log ä¾†é¡¯ç¤ºåœ¨é é¢ä¸Š
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToPage(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logToPage(args.join(' '), 'error');
        };
        
        // æ¸¬è©¦é‡‘é¡è§£æ
        function testAmountParsing() {
            const input = document.getElementById('testAmount');
            const resultDiv = document.getElementById('parsingResult');
            
            console.log('ğŸ” æ¸¬è©¦é‡‘é¡è§£æ...');
            
            // æ¨¡æ“¬ getActualValue æ–¹æ³•
            if (input.getActualValue) {
                const rawValue = input.getActualValue();
                const parsed = rawValue ? parseFloat(rawValue) : 0;
                console.log('ä½¿ç”¨ getActualValue:', { rawValue, parsed });
            } else {
                const rawValue = input.value.replace(/[^0-9.-]/g, '');
                const parsed = rawValue ? parseFloat(rawValue) : 0;
                console.log('ä½¿ç”¨ç›´æ¥è§£æ:', { rawValue, parsed });
            }
            
            resultDiv.innerHTML = `
                <div class="alert alert-success">
                    <strong>è§£ææˆåŠŸ</strong><br>
                    åŸå§‹å€¼: ${input.value}<br>
                    è§£æçµæœ: ${parsed}<br>
                    æ˜¯å¦ç‚ºæ•¸å­—: ${!isNaN(parsed)}
                </div>
            `;
        }
        
        // æ¸¬è©¦é©—è­‰é‚è¼¯
        function testValidation() {
            const input = document.getElementById('validationAmount');
            const resultDiv = document.getElementById('validationResult');
            
            console.log('ğŸ” æ¸¬è©¦é©—è­‰é‚è¼¯...');
            
            // æ¨¡æ“¬è§£æé‚è¼¯
            let settlementAmount;
            if (input.getActualValue) {
                const rawValue = input.getActualValue();
                settlementAmount = rawValue ? parseFloat(rawValue) : 0;
            } else {
                const rawValue = input.value.replace(/[^0-9.-]/g, '');
                settlementAmount = rawValue ? parseFloat(rawValue) : 0;
            }
            
            console.log('è§£æå¾Œçš„éŠ·å¸³é‡‘é¡:', settlementAmount);
            
            // æ¨¡æ“¬é©—è­‰é‚è¼¯
            let isValid = true;
            let errorMessage = '';
            
            if (!settlementAmount || settlementAmount <= 0 || isNaN(settlementAmount)) {
                isValid = false;
                if (isNaN(settlementAmount)) {
                    errorMessage = 'éŠ·å¸³é‡‘é¡æ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹è¼¸å…¥æ•¸å­—';
                } else if (settlementAmount <= 0) {
                    errorMessage = 'éŠ·å¸³é‡‘é¡å¿…é ˆå¤§æ–¼ 0';
                } else {
                    errorMessage = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„éŠ·å¸³é‡‘é¡';
                }
                console.error('âŒ éŠ·å¸³é‡‘é¡é©—è­‰å¤±æ•—:', { 
                    settlementAmount, 
                    isNaN: isNaN(settlementAmount),
                    inputValue: input.value
                });
            }
            
            if (isValid) {
                resultDiv.innerHTML = `
                    <div class="alert alert-success">
                        <strong>é©—è­‰é€šé</strong><br>
                        éŠ·å¸³é‡‘é¡: ${settlementAmount}<br>
                        ç‹€æ…‹: æœ‰æ•ˆ
                    </div>
                `;
                console.log('âœ… éŠ·å¸³é‡‘é¡é©—è­‰é€šé');
            } else {
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <strong>é©—è­‰å¤±æ•—</strong><br>
                        éŒ¯èª¤: ${errorMessage}<br>
                        è¼¸å…¥å€¼: "${input.value}"<br>
                        è§£æçµæœ: ${settlementAmount}
                    </div>
                `;
                console.error('âŒ éŠ·å¸³é‡‘é¡é©—è­‰å¤±æ•—:', errorMessage);
            }
        }
        
        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… éŠ·å¸³é‡‘é¡é©—è­‰ä¿®å¾©æ¸¬è©¦é é¢å·²è¼‰å…¥');
            
            // ç‚ºæ¸¬è©¦è¼¸å…¥æ¡†è¨­ç½®æ•¸å­—æ ¼å¼åŒ–
            const testAmountInput = document.getElementById('testAmount');
            const validationAmountInput = document.getElementById('validationAmount');
            
            if (typeof setupNumberInputFormatting === 'function') {
                setupNumberInputFormatting(testAmountInput, { maxDecimals: 2 });
                setupNumberInputFormatting(validationAmountInput, { maxDecimals: 2 });
                console.log('âœ… æ•¸å­—è¼¸å…¥æ ¼å¼åŒ–å·²æ‡‰ç”¨');
            }
        });
    </script>
</body>
</html>

