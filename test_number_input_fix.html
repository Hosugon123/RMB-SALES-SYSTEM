<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>數字輸入修復測試</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        .test-section { margin-bottom: 30px; padding: 20px; border: 1px solid #dee2e6; border-radius: 8px; }
        .test-result { margin-top: 10px; padding: 10px; background-color: #f8f9fa; border-radius: 4px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">🔧 數字輸入修復測試頁面</h1>
        
        <div class="alert alert-info">
            <h5>測試目的</h5>
            <p>驗證將 <code>type="number"</code> 改為 <code>type="text"</code> 後，數字輸入欄位是否能正常處理逗號格式化和表單提交。</p>
        </div>

        <!-- 測試 1: 基本數字輸入 -->
        <div class="test-section">
            <h4>📝 測試 1: 基本數字輸入</h4>
            <form id="testForm1">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="testAmount1" class="form-label">金額輸入 (RMB)</label>
                            <input type="text" class="form-control" id="testAmount1" name="amount" 
                                   pattern="[0-9]*\.?[0-9]*" placeholder="請輸入金額">
                            <div class="form-text">輸入數字時會自動添加逗號格式化</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="testRate1" class="form-label">匯率輸入</label>
                            <input type="text" class="form-control" id="testRate1" name="rate" 
                                   pattern="[0-9]*\.?[0-9]*" placeholder="請輸入匯率">
                            <div class="form-text">支援4位小數的匯率輸入</div>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">測試表單提交</button>
            </form>
            <div id="result1" class="test-result" style="display: none;"></div>
        </div>

        <!-- 測試 2: 大數字輸入 -->
        <div class="test-section">
            <h4>💰 測試 2: 大數字輸入</h4>
            <form id="testForm2">
                <div class="mb-3">
                    <label for="testLargeAmount" class="form-label">大金額輸入</label>
                    <input type="text" class="form-control" id="testLargeAmount" name="large_amount" 
                           pattern="[0-9]*\.?[0-9]*" placeholder="例如: 1000000">
                    <div class="form-text">輸入 1000000 應該顯示為 1,000,000.00</div>
                </div>
                <button type="submit" class="btn btn-success">測試大數字</button>
            </form>
            <div id="result2" class="test-result" style="display: none;"></div>
        </div>

        <!-- 測試 3: 小數輸入 -->
        <div class="test-section">
            <h4>🔢 測試 3: 小數輸入</h4>
            <form id="testForm3">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="testDecimal1" class="form-label">小數金額</label>
                            <input type="text" class="form-control" id="testDecimal1" name="decimal1" 
                                   pattern="[0-9]*\.?[0-9]*" placeholder="例如: 123.45">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="testDecimal2" class="form-label">精確匯率</label>
                            <input type="text" class="form-control" id="testDecimal2" name="decimal2" 
                                   pattern="[0-9]*\.?[0-9]*" placeholder="例如: 4.5678">
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-warning">測試小數</button>
            </form>
            <div id="result3" class="test-result" style="display: none;"></div>
        </div>

        <!-- 測試 4: 表單驗證 -->
        <div class="test-section">
            <h4>✅ 測試 4: 表單驗證</h4>
            <form id="testForm4">
                <div class="mb-3">
                    <label for="testValidation" class="form-label">驗證輸入</label>
                    <input type="text" class="form-control" id="testValidation" name="validation" 
                           pattern="[0-9]*\.?[0-9]*" required>
                    <div class="form-text">嘗試輸入無效字符（如字母）應該被阻止</div>
                </div>
                <button type="submit" class="btn btn-danger">測試驗證</button>
            </form>
            <div id="result4" class="test-result" style="display: none;"></div>
        </div>

        <!-- 測試結果總覽 -->
        <div class="test-section">
            <h4>📊 測試結果總覽</h4>
            <div id="overallResult" class="test-result">
                <p>點擊上方測試按鈕來查看結果...</p>
            </div>
        </div>
    </div>

    <!-- 增強的數字輸入處理腳本 -->
    <script src="static/js/enhanced_number_input.js"></script>
    
    <script>
        // 測試結果記錄
        let testResults = {
            test1: false,
            test2: false,
            test3: false,
            test4: false
        };

        // 顯示測試結果
        function showResult(testId, success, message) {
            const resultDiv = document.getElementById(`result${testId.slice(-1)}`);
            resultDiv.style.display = 'block';
            resultDiv.className = `test-result ${success ? 'success' : 'error'}`;
            resultDiv.innerHTML = `<strong>${success ? '✅ 成功' : '❌ 失敗'}:</strong> ${message}`;
            
            // 記錄結果
            testResults[testId] = success;
            updateOverallResult();
        }

        // 更新總體結果
        function updateOverallResult() {
            const overallDiv = document.getElementById('overallResult');
            const passedTests = Object.values(testResults).filter(Boolean).length;
            const totalTests = Object.keys(testResults).length;
            
            if (passedTests === totalTests) {
                overallDiv.className = 'test-result success';
                overallDiv.innerHTML = `
                    <h5>🎉 所有測試通過！</h5>
                    <p>數字輸入修復成功：</p>
                    <ul>
                        <li>✅ 支援逗號格式化</li>
                        <li>✅ 表單提交正常</li>
                        <li>✅ 數字驗證有效</li>
                        <li>✅ 小數點處理正確</li>
                    </ul>
                `;
            } else {
                overallDiv.className = 'test-result error';
                overallDiv.innerHTML = `
                    <h5>⚠️ 部分測試失敗</h5>
                    <p>通過測試: ${passedTests}/${totalTests}</p>
                    <p>請檢查失敗的測試項目</p>
                `;
            }
        }

        // 測試 1: 基本數字輸入
        document.getElementById('testForm1').addEventListener('submit', function(e) {
            e.preventDefault();
            const amount = document.getElementById('testAmount1').value;
            const rate = document.getElementById('testRate1').value;
            
            if (amount && rate) {
                showResult('test1', true, `成功提交：金額=${amount}, 匯率=${rate}`);
            } else {
                showResult('test1', false, '請填寫所有欄位');
            }
        });

        // 測試 2: 大數字輸入
        document.getElementById('testForm2').addEventListener('submit', function(e) {
            e.preventDefault();
            const amount = document.getElementById('testLargeAmount').value;
            
            if (amount && amount.includes(',')) {
                showResult('test2', true, `大數字格式化成功：${amount}`);
            } else {
                showResult('test2', false, '大數字格式化失敗');
            }
        });

        // 測試 3: 小數輸入
        document.getElementById('testForm3').addEventListener('submit', function(e) {
            e.preventDefault();
            const decimal1 = document.getElementById('testDecimal1').value;
            const decimal2 = document.getElementById('testDecimal2').value;
            
            if (decimal1 && decimal2) {
                showResult('test3', true, `小數輸入成功：${decimal1}, ${decimal2}`);
            } else {
                showResult('test3', false, '請填寫小數欄位');
            }
        });

        // 測試 4: 表單驗證
        document.getElementById('testForm4').addEventListener('submit', function(e) {
            e.preventDefault();
            const value = document.getElementById('testValidation').value;
            
            if (value && /^\d*\.?\d*$/.test(value)) {
                showResult('test4', true, `數字驗證通過：${value}`);
            } else {
                showResult('test4', false, '數字驗證失敗');
            }
        });

        // 頁面載入完成後的初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 數字輸入修復測試頁面已載入');
            
            // 自動填充一些測試數據
            setTimeout(() => {
                document.getElementById('testAmount1').value = '1000';
                document.getElementById('testRate1').value = '4.5';
                document.getElementById('testLargeAmount').value = '1000000';
                document.getElementById('testDecimal1').value = '123.45';
                document.getElementById('testDecimal2').value = '4.5678';
                document.getElementById('testValidation').value = '100';
            }, 1000);
        });
    </script>
</body>
</html>
